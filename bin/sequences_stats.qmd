---
title: "Rapport Séquences et Annotations"
format: html
editor: visual

params:
  before: "null"
  after: "null"
  annotation: "null"
  annotation_network: "null"
---

Ce rapport présente la distribution de la taille des séquences avant et après la constrution du réseau.

```{r}
#| echo: false
#| output: false

library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)

```

## Distribution de la taille des séquences

### Avant la construction du réseau

Figure 1 : Distributiond de la taille des séquences avant la construction l'alignement des séquences avec Diamond BLASTp et les étapes de filtrations effectué avant la constrution du réseau.

```{r}
#| echo: false
#| output: false

df.length <- read.table(params$before, col.names = c("protein_accession", "length"), header = FALSE, sep = "\t")

plot.length <- df.length |> 
   ggplot(aes(x = length)) +
   geom_histogram(bins = 200, color = "steelblue") +
   theme_light() +
   labs(title = "Distribution de la taille des séquences",
        subtitle = "Avant la construction du réseau",
        x = "Longeur",
        y = "Nombre de séquences") +
   theme(plot.title = element_text(size = 15, face = "bold"),
         plot.subtitle = element_text(size = 15),
         axis.title = element_text(size = 15, face = "bold"),
         axis.text = element_text(size = 12))
```

```{r}
#| label: figure-1
#| echo: false

plot.length
```

### Dans le réseau

Figure 2 : Distribution de la taille des séquences présente dans le réseau.

```{r}
#| echo: false
#| output: false

df.length.network <- read.table(params$after, col.names = c("protein_accession", "length"), header = FALSE, sep = "\t")

plot.length.network <- df.length.network |> 
   ggplot(aes(x = length)) +
   geom_histogram(bins = 200, color = "steelblue") +
   theme_light() +
   labs(title = "Distribution de la taille des séquences",
        subtitle = "Avant la construction du réseau",
        x = "Longeur",
        y = "Nombre de séquences") +
   theme(plot.title = element_text(size = 15, face = "bold"),
         plot.subtitle = element_text(size = 15),
         axis.title = element_text(size = 15, face = "bold"),
         axis.text = element_text(size = 12))
```

```{r}
#| label: figure-2
#| echo: false

plot.length.network
```

### Nombre de séquence retenu dans le réseau

```{r}
#| label: table-1
#| echo: false

before_nework <- c(nrow(df.length))
after_network <- c(nrow(df.length.network))

sequence <- data.frame(before_nework, after_network)
colnames(sequence) <- c("Sequence before network", "Sequence after network")

kable(sequence,
      "html",
      caption = "Nombre de séquence avant et après la constrution du réseau")
```

## Étude des séquences annotées dans le réseaux en fonction des informations

### initialement

```{r}
#df.annotation.init <- read.table("/home/jrousseau/Documents/git_projects/workflow-laggoon-mcl/lagoon-mcl-recup/workdir/lagoon-mcl/4a/2f63945a84687f103bc00657d433ce/annotation", header = FALSE, col.names = c("protein_accession", "database"), sep = "\t")

df.annotation.init <- read.table(params$annotation, header = FALSE, col.names = c("protein_accession", "database"), sep = "\t")

df.annotation.init.filter <- df.annotation.init |> 
   filter(database != "gene3d_architecture") |> 
   filter(database != "gene3d_class") |> 
   filter(database != "gene3d_topology")

df.annotation.init.filter$database[df.annotation.init.filter$database == "gene3d_superfamily"] <- "gene3d"

df.annotation.init.filter |> 
   group_by(database) |> 
   summarise(count = n(),
             prop_annote = count * 100 / before_nework,
             n_seq_net = before_nework)


```

### dans le réseau

```{r}

#df.annotation <- read.table("/home/jrousseau/Documents/git_projects/workflow-laggoon-mcl/lagoon-mcl-recup/workdir/lagoon-mcl/df/7b5fa2a88f94146db18d2be8b37ad3/annotation", header = FALSE, col.names = c("protein_accession", "length", "database"), sep = "\t")

df.annotation <- read.table(params$annotation_network, header = FALSE, col.names = c("protein_accession", "length", "database"), sep = "\t")

df.annotation.filter <- df.annotation |> 
   filter(database != "gene3d_architecture") |> 
   filter(database != "gene3d_class") |> 
   filter(database != "gene3d_topology")

df.annotation.filter$database[df.annotation.filter$database == "gene3d_superfamily"] <- "gene3d"

df.sequence.network <- df.annotation.filter |> 
   group_by(database) |> 
   summarise(count = n(),
             prop_annote = count * 100 / after_network,
             n_seq_net = after_network)
colnames(df.sequence.network) <- c("Banque de données", "Nombre de séquence annoté dans le réseau", "proportion de séquence annoté dans le réseau")

df.sequence.network
```

### Class

### Architecture

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).

Génération du PDF

```{r}
#| echo: false
#| output: false

pdf(file = "sequence_length_after_network.pdf")
  
print(plot.length)
  
dev.off()
```
